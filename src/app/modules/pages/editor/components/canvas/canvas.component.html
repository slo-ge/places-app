<app-loading-animation *ngIf="loading"></app-loading-animation>
<div class="preview">
  <aside [class.visible]="mobileToolbar">
    <tabs [currentIndex]="(loggedInUser | async)?.user ? 0 : undefined">
      <tab tabTitle="Presets" [faIcon]="faPalette">
        <app-url-meta-properties-input *ifFeatureFlag="FeatureFlags.SHOW_INLINE_META_INPUT" (meta)="metaProperties = $event; refreshCanvas()"></app-url-meta-properties-input>
        <app-layout-selector (layout)="setLayout($event)"></app-layout-selector>
      </tab>
      <tab tabTitle="Add" [faIcon]="faCode">
        <app-meta-data-actions *ngIf="currentPresetService"
                               [presetService]="currentPresetService"
                               [metaProperties]="metaProperties">
        </app-meta-data-actions>
      </tab>

      <tab tabTitle="Share" [faIcon]="faDownload">
          <app-tab-download [presetService]="currentPresetService"></app-tab-download>
      </tab>

      <tab tabTitle="User" [faIcon]="faUser" *ifFeatureFlag="FeatureFlags.SHOW_USER_SETTINGS">
        <ng-container *ngIf="(loggedInUser | async)?.user?.isAdmin">
          <button [routerLink]="['./']" class="save-change secondary" queryParamsHandling="merge" [queryParams]="{userPresetsOnly: true}">User templates</button>
          <button class="save-change secondary" (click)="resetTemplate()">Reset Template
            <fa-icon [icon]="undoIcon"></fa-icon>
          </button>
          <button class="save-change secondary" (click)="updateValues()">Save Preset
            <fa-icon [icon]="saveChangesIcon"></fa-icon>
          </button>
          <div>{{sentUpdateResponse}}</div>
        </ng-container>
        <app-profile></app-profile>
      </tab>
    </tabs>
  </aside>
  <main>
    <div class="canvas-actions">
      <div class="actions-row">
        <div class="mobile-opener" (click)="mobileToolbar = !mobileToolbar">
          <fa-icon [icon]="faPlus" *ngIf="!mobileToolbar"></fa-icon>
          <fa-icon [icon]="faWindowClose" *ngIf="mobileToolbar"></fa-icon>
        </div>
        <app-simple-actions></app-simple-actions>
      </div>
    </div>

    <div class="canvas-wrapper" style="--zoom-factor: {{zoomFactor}}">
      <canvas id="myCanvas"></canvas>
    </div>
    <app-zoom (zoomFactorChange)="setZoomFactor($event)" [zoomFactor]="initZoom"></app-zoom>
  </main>
</div>
